================================
Health Hub éƒ¨ç½²å‘½ä»¤é€ŸæŸ¥è¡¨
================================

ğŸ“¦ æœ¬åœ°Macä¸Šä¼ éƒ¨ç½²
-----------------------------------
./upload-and-deploy.sh ubuntu@server-ip

ğŸ“¦ æœåŠ¡å™¨ä¸€é”®éƒ¨ç½²
-----------------------------------
./deploy-ubuntu-simple.sh

ğŸ“¦ æ‰‹åŠ¨Dockeréƒ¨ç½²
-----------------------------------
# 1. é…ç½®ç¯å¢ƒ
cp env.cloud.template .env.production
nano .env.production

# 2. æ„å»ºå’Œå¯åŠ¨
docker compose build --platform linux/amd64
docker compose up -d

# 3. åˆå§‹åŒ–æ•°æ®åº“
docker compose exec -T db mysql -u health_app -pappPass123! health_hub < database/migrations/002_create_user_action_logs.sql

ğŸ“Š æœåŠ¡ç®¡ç†å‘½ä»¤
-----------------------------------
# æŸ¥çœ‹çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f app

# é‡å¯æœåŠ¡
docker compose restart

# åœæ­¢æœåŠ¡
docker compose down

# å®Œå…¨é‡å»º
docker compose down -v
docker compose build --no-cache
docker compose up -d

ğŸ” å¥åº·æ£€æŸ¥
-----------------------------------
./server-health-check.sh

ğŸ“ˆ æ•°æ®åº“ç®¡ç†
-----------------------------------
# è¿›å…¥æ•°æ®åº“
docker compose exec db mysql -u health_app -pappPass123! health_hub

# å¤‡ä»½
docker compose exec db mysqldump -u root -prootpass123! health_hub > backup_$(date +%Y%m%d).sql

# æ¢å¤
docker compose exec -T db mysql -u health_app -pappPass123! health_hub < backup.sql

ğŸ” ç”Ÿæˆéšæœºå¯†é’¥
-----------------------------------
openssl rand -base64 32

ğŸ›¡ï¸ é˜²ç«å¢™é…ç½®
-----------------------------------
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 3000/tcp
sudo ufw enable

ğŸŒ Nginxåå‘ä»£ç†
-----------------------------------
sudo apt install nginx -y
sudo nano /etc/nginx/sites-available/health-hub
sudo ln -s /etc/nginx/sites-available/health-hub /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

ğŸ”’ SSLè¯ä¹¦
-----------------------------------
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d your-domain.com

ğŸ“ æ—¥å¿—æŸ¥çœ‹
-----------------------------------
# åº”ç”¨æ—¥å¿—
docker compose logs app --tail=100

# æ•°æ®åº“æ—¥å¿—
docker compose logs db --tail=50

# å®æ—¶æ—¥å¿—
docker compose logs -f

# å®¹å™¨å†…æ—¥å¿—
docker compose exec app cat /app/logs/app.log

ğŸ”„ æ›´æ–°éƒ¨ç½²
-----------------------------------
git pull
docker compose build app
docker compose up -d

âŒ æ•…éšœæ’æŸ¥
-----------------------------------
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps

# æ£€æŸ¥ç½‘ç»œ
docker compose exec app ping db

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker compose exec app env | grep DB_

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart app
docker compose restart db

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

ğŸ’¾ å¤‡ä»½å‘½ä»¤ï¼ˆæ·»åŠ åˆ°crontabï¼‰
-----------------------------------
# æ¯å¤©2ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * docker compose exec db mysqldump -u root -prootpass123! health_hub > /backups/db_$(date +\%Y\%m\%d).sql

# æ¯å¤©3ç‚¹å¤‡ä»½æ–‡ä»¶
0 3 * * * tar -czf /backups/uploads_$(date +\%Y\%m\%d).tar.gz /path/to/public/uploads/

ğŸ”§ PM2éƒ¨ç½²ï¼ˆä¸ä½¿ç”¨Dockerï¼‰
-----------------------------------
# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install nodejs -y

# æ„å»ºå’Œå¯åŠ¨
npm install
npm run build
npm install -g pm2
pm2 start npm --name health-hub -- start
pm2 startup
pm2 save

# PM2ç®¡ç†
pm2 list
pm2 logs health-hub
pm2 restart health-hub
pm2 stop health-hub

================================
å¿«é€Ÿè®¿é—®
================================
åº”ç”¨åœ°å€: http://server-ip:3000
å¥åº·æ£€æŸ¥: http://server-ip:3000/api/health
MySQLç«¯å£: server-ip:3307

================================
é‡è¦æé†’
================================
1. ä¿®æ”¹æ‰€æœ‰é»˜è®¤å¯†ç 
2. ç”Ÿæˆæ–°çš„è®¤è¯å¯†é’¥
3. é…ç½®é˜²ç«å¢™
4. è®¾ç½®è‡ªåŠ¨å¤‡ä»½
5. é…ç½®SSLè¯ä¹¦

