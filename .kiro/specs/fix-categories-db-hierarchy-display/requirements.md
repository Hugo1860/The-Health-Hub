# 修复分类管理界面层级显示问题需求文档

## 介绍

本功能旨在修复 `admin/categories-db` 页面中二级分类不显示的问题。当前页面虽然有显示层级信息的代码，但可能由于数据库迁移未执行、缺少测试数据或前端显示逻辑问题，导致用户看不到二级分类的内容。

## 需求

### 需求 1：确保数据库层级结构完整

**用户故事：** 作为系统管理员，我希望数据库表结构支持完整的分类层级功能，以便能够存储和管理二级分类数据。

#### 验收标准

1. WHEN 我检查数据库表结构时 THEN 系统 SHALL 包含 `parent_id`、`level`、`sort_order` 字段
2. WHEN 我查询分类表时 THEN 系统 SHALL 支持层级关系的外键约束
3. WHEN 我创建二级分类时 THEN 系统 SHALL 自动设置正确的层级和父子关系
4. WHEN 我查看数据库约束时 THEN 系统 SHALL 包含层级一致性检查约束

### 需求 2：创建测试二级分类数据

**用户故事：** 作为管理员，我希望系统中有一些二级分类的测试数据，以便验证层级管理功能是否正常工作。

#### 验收标准

1. WHEN 我访问分类管理页面时 THEN 系统 SHALL 显示至少2-3个一级分类下的二级分类
2. WHEN 我查看心血管分类时 THEN 系统 SHALL 显示如"高血压"、"心律失常"等二级分类
3. WHEN 我查看神经科分类时 THEN 系统 SHALL 显示如"脑卒中"、"癫痫"等二级分类
4. WHEN 我查看统计信息时 THEN 系统 SHALL 正确显示一级和二级分类的数量

### 需求 3：修复前端层级显示逻辑

**用户故事：** 作为管理员，我希望在分类管理界面中能够清晰地看到分类的层级关系和父子关系。

#### 验收标准

1. WHEN 我查看分类列表时 THEN 系统 SHALL 在分类名称旁显示"一级"或"二级"标签
2. WHEN 我查看二级分类时 THEN 系统 SHALL 在父分类列显示对应的父分类名称
3. WHEN 我查看统计信息时 THEN 系统 SHALL 正确显示一级分类和二级分类的数量
4. WHEN 我查看分类详情时 THEN 系统 SHALL 显示完整的层级信息

### 需求 4：增强分类创建功能

**用户故事：** 作为管理员，我希望能够在分类管理界面中创建二级分类，选择合适的父分类。

#### 验收标准

1. WHEN 我点击新增分类时 THEN 系统 SHALL 提供选择父分类的选项
2. WHEN 我选择父分类时 THEN 系统 SHALL 自动将新分类设置为二级分类
3. WHEN 我不选择父分类时 THEN 系统 SHALL 将新分类设置为一级分类
4. WHEN 我保存新分类时 THEN 系统 SHALL 正确设置层级和排序信息

### 需求 5：改进层级数据验证

**用户故事：** 作为系统管理员，我希望系统能够验证分类层级数据的一致性，防止数据错误。

#### 验收标准

1. WHEN 系统启动时 THEN 系统 SHALL 验证所有分类的层级数据一致性
2. WHEN 创建二级分类时 THEN 系统 SHALL 验证父分类存在且为一级分类
3. WHEN 删除一级分类时 THEN 系统 SHALL 检查是否有子分类并提供处理选项
4. WHEN 发现数据不一致时 THEN 系统 SHALL 提供修复建议和操作

### 需求 6：优化层级显示界面

**用户故事：** 作为管理员，我希望分类管理界面能够更直观地展示层级关系，提升使用体验。

#### 验收标准

1. WHEN 我查看分类列表时 THEN 系统 SHALL 使用缩进或图标区分层级
2. WHEN 我查看二级分类时 THEN 系统 SHALL 使用不同颜色的标签区分层级
3. WHEN 我排序分类时 THEN 系统 SHALL 按层级和排序字段正确排序
4. WHEN 我筛选分类时 THEN 系统 SHALL 支持按层级筛选功能

### 需求 7：添加层级管理工具

**用户故事：** 作为管理员，我希望有专门的工具来管理和维护分类层级结构。

#### 验收标准

1. WHEN 我访问分类管理页面时 THEN 系统 SHALL 提供层级结构检查工具
2. WHEN 我运行结构检查时 THEN 系统 SHALL 报告层级数据的健康状态
3. WHEN 我发现问题时 THEN 系统 SHALL 提供自动修复选项
4. WHEN 我需要重建层级时 THEN 系统 SHALL 提供数据重建工具

### 需求 8：完善错误处理和用户反馈

**用户故事：** 作为管理员，我希望在操作分类层级时能够得到清晰的错误提示和操作反馈。

#### 验收标准

1. WHEN 层级操作失败时 THEN 系统 SHALL 显示具体的错误原因
2. WHEN 数据加载失败时 THEN 系统 SHALL 提供重试和诊断选项
3. WHEN 创建分类成功时 THEN 系统 SHALL 显示成功消息并刷新列表
4. WHEN 删除操作有风险时 THEN 系统 SHALL 显示详细的影响说明