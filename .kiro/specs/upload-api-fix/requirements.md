# 上传API修复需求文档

## 介绍

当前上传API在 `/api/upload` 端点出现500内部服务器错误。通过代码分析发现，`extractFilesFromRequest` 函数被错误调用，传入了 `formData` 对象而不是 `NextRequest` 对象，导致API调用失败。需要修复这个问题以确保音频文件能够正常上传。

## 需求

### 需求 1

**用户故事：** 作为管理员，我希望能够成功上传音频文件，以便用户可以访问这些内容

#### 验收标准

1. WHEN 用户通过 `/api/upload` 端点上传音频文件 THEN 系统应该成功处理请求并返回200状态码
2. WHEN `extractFilesFromRequest` 函数被调用 THEN 它应该接收正确的 `NextRequest` 参数
3. WHEN 文件上传成功 THEN 系统应该返回包含音频信息的JSON响应

### 需求 2

**用户故事：** 作为开发者，我希望上传API有适当的错误处理，以便能够诊断和解决问题

#### 验收标准

1. WHEN API调用失败 THEN 系统应该返回有意义的错误消息
2. WHEN 文件验证失败 THEN 系统应该返回具体的验证错误信息
3. WHEN 数据库操作失败 THEN 系统应该记录详细的错误日志

### 需求 3

**用户故事：** 作为用户，我希望上传过程是安全的，以便保护系统免受恶意文件攻击

#### 验收标准

1. WHEN 文件被上传 THEN 系统应该验证文件类型和大小
2. WHEN 文件内容被检查 THEN 系统应该验证文件签名以防止类型伪造
3. WHEN 文件被保存 THEN 系统应该使用安全的文件名和路径